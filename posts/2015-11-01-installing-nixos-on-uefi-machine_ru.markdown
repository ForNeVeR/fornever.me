---
title: Установка NixOS на машину с UEFI
description: Небольшая заметка для быстрой установки NixOS на машины с UEFI.
---

Многие уже в курсе, что я в последнее время начал сильно интересоваться
[NixOS][nixos]. Это современная операционная система, очень простая в установке
и обслуживании, чем она мне изначально и понравилась. Несмотря на всю простоту
начальной настройки при установке (в [соответствующем разделе
руководства][nixos-install-manual] всего несколько страниц), с системами на базе
[UEFI][uefi] не всё так просто. За последний месяц я уже дважды устанавливал
NixOS на различные машины, использующие UEFI, и каждый раз были проблемы из-за
недостаточно полной проработки этого вопроса в руководстве.

Итак, что следует помнить при установке: сначала прочитайте [раздел про
UEFI][nixos-uefi-manual], и только потом общий раздел руководства!

Дальше я приведу максимально краткую выжимку, просто чтобы самому в будущем по
ней действовать.

Итак, на этапе создания файловой системы нужно создать два раздела (а не один,
как я делаю обычно): один будет использоваться для `/boot` (и ссылка на него
будет автоматически прописана где-то в UEFI), а второй --- для корневой файловой
системы. Эту файловую систему следует отформатировать в файловую систему `vfat`
с помощью команды `mkfs.vfat`.

Также следует **до запуска `nixos-generate-config`** подмонтировать раздел
`/boot` к корневой файловой системе. Полностью этап монтирования может выглядеть
так:

```bash
mount /dev/disk/by-label/nixos /mnt
mkdir /mnt/boot
mount /dev/sda1 /mnt/boot
```

Только после этого можно, как обычно, запускать `nixos-generate-config` и
`nixos-install`. Каких-либо проблем с автоматическим определением наличия UEFI
на машине у меня ещё ни разу не было.

С учётом данных уточнений можно спокойно следовать руководству по установке ---
в остальном оно достаточно подробно и понятно объясняет происходящее, можно
успешно установить операционную систему с первого раза :)

[nixos]: http://nixos.org/
[nixos-install-manual]: http://nixos.org/nixos/manual/index.html#sec-installation
[nixos-uefi-manual]: http://nixos.org/nixos/manual/index.html#sec-uefi-installation
[uefi]: https://en.wikipedia.org/wiki/Unified_Extensible_Firmware_Interface
