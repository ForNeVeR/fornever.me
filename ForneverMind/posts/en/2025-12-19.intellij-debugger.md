    title: Implementing debugger for IntelliJ Platform
    description: This describes implementing a sample debugger based on XDebugger API of IntelliJ Platform.
---
TODO: explain my choice of Lua and DBGp.

## Environment Setup
Lua is not easy to install nowadays; it seems a bit deserted (I was unable to find fresh binaries or Windows or installers for modern versions like 5.4). But anyways, here are the steps I took.

1. Download [Lua for Windows][lua-for-windows]. For the purpose of this article, I used version v5.1.5-52.
2. Install it, uncheck installing the editor.

## Repository Setup
I used the [IntelliJ Platform Plugin Template repository][intellij-platform-plugin-template]. And then we can get to programming.

[See the repository][repository] with all the mentioned code.

## Sample Program
I asked the AI to quickly generate a "guess the number"-type game, and it was quite successful. To make sure your environment is set up correctly, check that it runs:

```console
$ lua src/samples/lua/sample.lua
=== Guess the Number (Lua) ===

I've picked a number between 1 and 100. Can you guess it?
Type 'q' to quit the round.
Your guess: 50
Too low!
Your guess: 75
Too high!
Your guess: 65
Too low!
Your guess: 70
Correct! You guessed it in 4 tries.

Play again? (y/n): [Press Ctrl+C here] Bye!
```
(you might need to replace `lua` with the full path to your Lua interpreter installation.)

## Implementation
### Breakpoints
The first thing we need is to allow the user to put the breakpoints into `.lua` files; by default, IDE will not allow this, as the files are recognized as the plain-text ones (even though they are augmented by the TextMate highlighting).

So, let's start by creating a class inheriting the `XLineBreakpointType`:
```kotlin
class LuaBreakpointType : XLineBreakpointType<XBreakpointProperties<*>>("lua", DebuggerBundle.message("lua.breakpoint.type.display.name")) {

    override fun canPutAt(
        file: VirtualFile,
        line: Int,
        project: Project
    ): Boolean {
        return file.extension == "lua"
    }

    override fun createBreakpointProperties(
        file: VirtualFile,
        line: Int
    ): XBreakpointProperties<*>? = null
}
```

Here, the most important part is the `canPutAt` method, which checks if the file extension is `lua`. In other languages, you might decide to check for file's language (since the user might mark other files as belonging to the language), but for this simple example check for file extension will be enough.

[intellij-platform-plugin-template]: https://github.com/JetBrains/intellij-platform-plugin-template
[lua-for-windows]: https://github.com/rjpcomputing/luaforwindows
[repository]: https://github.com/ForNeVeR/intellij-debugger-sample
