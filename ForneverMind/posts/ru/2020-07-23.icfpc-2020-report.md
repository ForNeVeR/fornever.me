    title: Отчёт об ICFP Contest 2020
    description: Описание недавно прошедшего соревнования и обсуждение результатов.
---

Недавно закончилось ежегодное соревнование, которое официально называется [ICFP
Programming Contest 2020][icfpc-2020], а по моим документам для простоты
проходит просто как ICFPC-2020. Как и [в прошлом году][ifcpf-2019-report], я
постарался прямо на ходу сохранить какие-то заметки по каждому дню соревнования,
чтобы упростить себе работу по составлению итогового отчёта. Из этих вот
ежедневных фрагментов (и некоторой дополнительной информации, которую собрал уже
позже) я и собрал нижеизложенный отчёт.

На этот раз соревнование фактически началось намного раньше официального старта:
1 июля аккаунт @zaitsev85, по сюжету принадлежащий астроному Ивану Зайцеву из
уральской обсерватории Пеговка, [выложил на GitHub][first-commit] обращение к
учёным и инженерам, в котором он просит помочь с расшифровкой таинственной
радиопередачи, полученной из космоса (приложена в виде аудиофайла).

В течение последующих нескольких недель сообщество понемножку расшифровывало эту
и новые поступающие сообщения — как было выяснено, присылаемые космическим
аппаратом с (возможно) живыми инопланетянами на борту!

Аудиосообщения тривиально преобразовывались в двухмерные пикселизованные
изображения, которые рассказывали нам об инопланетной системе записи чисел и
базовой арифметике. Сообщество с интересом взялось разгадывать смысл этих
посланий: кто-то считал, что там зашифрованы химические символы, кто-то видел
отрывки ДНК.

По задачам прошлых лет я помнил, что все эти разминки перед настоящим
соревнованием, как правило, не имеют к нему прямого отношения, и поэтому
принимать участие в этом исследовании вовсе не обязательно. Тем более, что оно
носило какой-то скорее творческий, нежели прагматичный характер, как мне тогда
показалось.

Поэтому я спокойно занимался своими делами, готовил инфраструктуру, и немножко
участвовал в формировании команды (хотя тут больше меня, конечно, постарался
Минору). В итоге наша команда состояла из следующих людей (приведу список
аккаунтов на GitHub, честно перемешанный первым попавшимся сниппетом на
PowerShell):

- [Akon32][github.akon32]
- [Minoru][github.minoru]
- [ForNeVeR][github.fornever]
- [mr146][github.mr146]
- [unclechu][github.unclechu]
- [pink-snow][github.pink-snow]
- [IngvarJackal][github.ingvarjackal]
- [portnov][github.portnov]

mr146 присоединился к нам совершенно неожиданно: это мой коллега, который
(видимо) нашёл в моём блоге отчёты прошлых лет и изъявил желание поучаствовать.
Хоть для чего-то мои старые отчёты пригодились!

Понемногу продвигалась и подготовка по другим фронтам: мы традиционно создали
запароленную конференцию в XMPP, но, помимо неё, в духе времени включили и
трансляцию этой конференции в закрытую группу в Telegram. Для этого пришлось
[наспех запатчить][emulsion.pr] бота, который занимается проксированием
сообщений, чтобы он научился заходить в запароленные конференции. Ну и
оказалось, что он не умеет нормально транслировать изображения и другие
медиасообщения из Telegram, что доставило некоторые неудобства. Надо будет
всё-таки доработать эту его возможность.

Ближе к началу соревнования мы также собрались и проверили окружение у всех
участников: каждый установил Haskell Stack (потому что в этом году была
договорённость писать на Haskell), и проверил, что всё правильно собирается и
работает.

## 2020-07-17

Подходит к концу первый день ICFP Contest 2020, и поэтому я решил оставить
некоторые заметки.

Как оказалось, последние несколько дней (наверное, уже целую неделю) некоторые
задачи соревнования уже были доступны!

По сюжету, астроном из некой Пеговки, Иван Зайцев, получает сообщения от
инопланетного космического корабля, и декодирует их в изображения. На этих
изображениях мы смогли увидеть сначала цифры, потом математические операции, а
затем — и целый язык программирования!

Смысл соревнования, кажется, в написании интерпретатора для программ на этом
инопланетном языке. Завязка хорошая, а вот исполнение немного подкачало: меня
очень расстроило то, что, оказывается, контест по существу начался за неделю до
официального старта. Да, организаторы и раньше подкидывали какие-то загадки, но
никогда они не имели настолько прямого отношения к происходящему. А тут вышло,
что те, кто начал участие заранее, и ознакомился со всеми сведениями, получил
значительное преимущество в соревновании.

Я как раз на днях дособрал новый компьютер, и поэтому решил попробовать
развернуть окружение для Haskell на нём, и вот незадача: как обычно, нашёлся
[баг в GHC](https://gitlab.haskell.org/ghc/ghc/-/issues/17926), который помешал
мне это сделать по-нормальному.

В итоге в первый день я практически ничего полезного не делал, а просто
знакомился с документацией и пытался развернуть локальное Haskell-окружение,
лавируя между бесконечными багами и проблемами.

## 2020-07-18

Заканчивается второй день соревнования. За сегодня мы очень хорошо поработали,
но кажется, что мы едва достаём до самого внешнего слоя задачи. В Lightning
round мы, как обычно, никак не выступили, и сейчас занимаемся уже полноценной
реализацией задачи.

Раскрылось следующее: написание интерпретатора для языка (который из себя
представляет ничто иное, как лямбда-счисление с кодировкой Чёрча для многих
вещей типа логического типа и списков) — это лишь самое начало задачи. (Кстати,
основной интерпретатор на текущий момент мы так и не доделали хоть до какого-то
работоспособного состояния.) Настоящая задача — это работа интерпретатора в
связке с функцией `send`, которая отправляет команды на внешний сервер, а он нам
в ответ присылает скриншоты некоего инопланетного GUI. Мы отправляем координаты
«кликов», а нам в ответ — ещё скриншоты; что там дальше делать — совершенно
непонятно.

На текущий момент есть какие-то подающие надежды эксперименты на Питоне (которых
я стараюсь не касаться, ибо никакого интереса в работе с этим языком не ощущаю),
и полуработающий интерпретатор на Haskell — который был сегодня начат мной (на
базе уже имеющихся наработок по упрощению выражений, весьма хорошего качества),
и сейчас подхвачен Портномым и Минору, которые доводят его до ума.

unclechu за прошедшее время успел перевести HTTP API на Servant (какая-то крутая
библиотека для Haskell), но у нас открылись сложности с её использованием в
тестовом окружении организаторов, поэтому в итоге ему пришлось всё переписывать
обратно.

@mr146, мой коллега из JetBrains, который присоединился к нам в течение
какого-то времени до начала соревнования, сейчас занимается какими-то
наработками на C#. Также, я решил написать GUI на C#, но не переписывать при
этом эвалюатор и прочее, а просто сделать IPC с программой на Haskell.
Посмотрим, что из этого получится.

## 2020-07-19

За ночь организаторы соревнования выложили свою реализацию эвалюатора, по
образцу которой мы относительно быстро смогли починить свою. Сегодня, после
некоторых споров, реализовали UI на C# (Avalonia нас действительно спасла и
почти без проблем завелась у всех участников); при этом бэкендом для неё стала
программа на Haskell (я быстро прикрутил протокол на stdin/stdout _на основе
языка программирования инопланетян_, что отдельно забавно).

Мы смогли поисследовать UI и порешать там всякие забавные задачи, но в итоге
уткнулись в то, что для непосредственного запуска игры нужно прикрутить работу с
сервером организаторов. Это доставило несколько неудобств, но в итоге мы это
сделали.

Однако, в итоге только часть нашей команды пилит работающего бота на Питоне, а я
с остальными активно занимаюсь доработкой инфраструктуры на Хаскелле. Взял на
завтра отгул на работе, надеюсь плотно заняться непосредственной задачей.

## 2020-07-20

Соревнование уже подходит к концу, так что я нашёл время для того, чтобы
дописать этот текст.

Сегодня я развлекался доработкой нашего творения на Haskell, и даже научил его
заходить в игру и делать какие-то действия. К сожалению, за всё время
соревнования мне так и не удалось перейти к активной стадии разработки (когда
нужно придумывать стратегии и принимать участие в сражениях): получается, что
всё время я занимался, по сути, бесполезной работой, которая в зачёт команде
практически не пошла.

Тем временем остальные допинывали бота на Python, и мы даже достигли довольно
неплохих результатов: 37 места на момент традиционной заморозки рейтинга
(впрочем, по баллам у нас всё не так уж и хорошо: у команд в топе до 264 очков,
а у нас всего 26). Всего команд, набравших больше нуля баллов, 62 штуки, так что
мы где-то пониже середины рейтинга.

Основной проблемой для нас стало, как обычно, резкое рассредоточение усилий.
Значительное время было потрачено на разработку бота на Haskell, который так и
не был опубликован. Это печально, но что ж поделаешь. Также, лично меня очень
сильно демотивировала эта ситуация: видя, как развивается бот на Python, я не
мог хорошо сосредоточиться на доработках Haskell. Ну и нормально расписаться для
работы с Haskell получилось только к самому последнему дню соревнования (в
котором я обычно вообще не принимал участия, т.к. это уже рабочий день).

Ещё стоит отметить, что на Python было несколько жалоб в связи с тем, что он не
проверяет корректность программ во время компиляции, и поэтому даже в последние
минуты мы умудрились отправить организаторам поломанную программу :(

![Пользовательский интерфейс фронтенда с изображённой галактикой][images.galaxy]
![Список реплеев в пользовательском интерфейсе][images.replays]

На момент заморозки таблицы лидеров мы занимали в ней 37-е место.

[images.galaxy]: ../images/2020-07-20.galaxy.png
[images.replays]: ../images/2020-07-20.replays.png

[emulsion.pr]: https://github.com/codingteam/emulsion/pull/114
[first-commit]: https://github.com/zaitsev85/message-from-space/commit/c53db85a31530080defd0277554048929d44edf3
[github.akon32]: https://github.com/Akon32
[github.minoru]: https://github.com/Minoru
[github.fornever]: https://github.com/ForNeVeR
[github.mr146]: https://github.com/mr146
[github.unclechu]: https://github.com/unclechu
[github.pink]: https://github.com/pink
[github.ingvarjackal]: https://github.com/IngvarJackal
[github.portnov]: https://github.com/portnov
[icfpc-2019-report]: posts/2019-07-05-icfpc-2019.md
[icfpc-2020]: https://icfpcontest2020.github.io/
